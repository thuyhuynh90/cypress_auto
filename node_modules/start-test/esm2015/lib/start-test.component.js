import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FormBuilder } from '@angular/forms';
export class StartTestComponent {
    constructor(fb) {
        this.fb = fb;
        this.ansFilling = false;
        this.outputFunction = new EventEmitter();
        this.sectionsForm = [];
    }
    ngOnInit() {
        this.timeUp.subscribe(resp => {
            if (resp) {
                this.submt();
            }
        });
        this.createTest();
    }
    initForm(qid, code = '') {
        return this.fb.group({
            q: [qid],
            ans: [],
            review: [false],
            cAns: [null]
        });
    }
    createTest() {
        let i = 1, j = 0;
        let formsData = [];
        this.finalDataList = [];
        this.inputForm = this.fb.group({
            id: [this.testSheet.id],
        });
        this.testSheet.sections.forEach(sec => {
            let finalData = new Object();
            this.finalDataList.push(finalData);
            finalData.sec = sec.sec;
            finalData.formsData = [];
            sec.types.forEach(typs => {
                let opts = [];
                let secTypes = new Object();
                finalData.formsData.push(secTypes);
                secTypes.formsData = [];
                if (typs.qType.code != "INPUT") {
                    if (typs.optType == "number") {
                        for (let tmp_i = 1; tmp_i <= typs.optCount; tmp_i++) {
                            opts.push(tmp_i);
                        }
                    }
                    else {
                        for (let tmp_i = 1; tmp_i <= typs.optCount; tmp_i++) {
                            opts.push(String.fromCharCode(tmp_i + 64));
                        }
                    }
                }
                else {
                    opts = 'input';
                }
                secTypes.info = `${typs.qType.name}.`;
                if ((typs.to - typs.from + 1) != typs.consider) {
                    secTypes.info = `${secTypes.info} Only first ${typs.consider} answers will be evaluated.`;
                }
                else {
                    secTypes.info = `${secTypes.info} All Questions Are Mandatory.`;
                }
                for (let tmp_i = typs.from; tmp_i <= typs.to; tmp_i++) {
                    let fid = this.initForm(`${sec.secId}-${i}`, typs.qType.code);
                    formsData.push(fid);
                    secTypes.formsData.push({
                        'id': fid,
                        'q': i++,
                        'opt': opts,
                        'qType': typs.qType.code,
                        'cutMarks': typs.cutMarks,
                        'marks': typs.marks
                    });
                }
            });
        });
        this.sectionsForm = formsData;
        this.inputForm.addControl("sections", this.fb.array(this.sectionsForm));
        console.log(this.finalDataList);
    }
    submt() {
        //let t = Object.assign({}, (this.fb.array(this.sectionsForm)).value);
        let t = Object.assign({}, this.inputForm.value);
        console.log(t);
        this.outputFunction.emit(t);
    }
}
StartTestComponent.decorators = [
    { type: Component, args: [{
                selector: 'start-test',
                template: "<p-tabView *ngIf=\"finalDataList != undefined && finalDataList.length > 0\">\r\n    <p-tabPanel [header]=\"fdl.sec\" *ngFor=\"let fdl of finalDataList; let i = index\" [selected]=\"i == 0\">\r\n        <ng-template pTemplate=\"content\" class=\"pad-0 col-xs-12\">\r\n            <form class=\"form-inline\" [formGroup]=\"inputForm\" (ngSubmit)=\"f.form.valid; submt();\" #f=\"ngForm\">\r\n                <div *ngFor=\"let fd of fdl.formsData;\" class=\"pad-0 col-xs-12 item_box\">\r\n                    <div class=\"pad-1 note bottom-text col-xs-12\">{{fd.info}}</div>\r\n                    <span *ngFor=\"let qst of fd.formsData; let fi = index\">\r\n                        <div [formGroup]=\"qst.id\" class=\"container-fluid\" novalidate>\r\n                            <div class=\"pad-0 col-xs-7\" style=\"font-size: 16px;\">\r\n                                <div class=\"pad-0 col-xs-2 text-center\">\r\n                                    <span style=\"top: 3px; position: relative;\">{{qst.q}}.</span>\r\n                                </div>\r\n                                <div class=\"pad-0 col-xs-10 text-center radio-full\">\r\n                                    <span *ngIf=\"qst.qType == 'MCQ'\">\r\n                                        <label class=\"options\" *ngFor=\"let opt of qst.opt\">\r\n                                            <p-radioButton name=\"{{qst.q}}\" value=\"{{opt}}\" formControlName=\"ans\"></p-radioButton>\r\n                                            <span>{{opt}}</span>\r\n                                        </label>\r\n                                    </span>\r\n                                    <span *ngIf=\"qst.qType == 'MSQ'\">\r\n                                        <label class=\"options\" *ngFor=\"let opt of qst.opt; let k = index\">\r\n                                            <p-checkbox name=\"msq-{{qst.q}}-{{i}}\" value=\"{{opt}}\" checkboxIcon=\"white pi pi-circle-on\" \r\n                                            [formControl]=\"qst.id.controls['ans']\"></p-checkbox>\r\n                                            <span>{{opt}}</span>\r\n                                        </label>\r\n                                    </span>\r\n                                    <span *ngIf=\"qst.qType == 'INPUT'\">\r\n                                        <div class=\"col-xs-12 form-group\" style=\"margin-bottom: 6px;\">\r\n                                            <input type=\"number\" id=\"sec-{{qst.q}}-{{i}}\" autocomplete=\"off\" class=\"form-control\"\r\n                                            style=\"padding: 2px 7px; font-size: large;\" formControlName=\"ans\">\r\n                                        </div>\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"pad-0 col-xs-5 text-center a\" style=\"font-size: 14px;\">\r\n                                <span class=\"pull-left fa fa-remove\" style=\"top: 5px; position: relative;\"\r\n                                    (click)=\"qst.id.controls['ans'].setValue(null)\">Clear</span>\r\n                                <span class=\"pull-right fa fa {{qst.id.controls['review'].value ? 'fa-eye' : 'fa-eye-slash'}}\" style=\"top: 5px; position: relative;\"\r\n                                    (click)=\"qst.id.controls['review'].setValue(!qst.id.controls['review'].value)\">Review</span>\r\n                            </div>\r\n                        </div>\r\n                    </span>\r\n                </div>\r\n                <div class=\"pad-0 col-xs-12\">\r\n                    <div class=\"pad-0 col-xs-12\" style=\"padding-top: 15px; padding-bottom: 15px;\">\r\n                      <button type=\"submit\" class=\"search_btn train_Search\">Submit Test</button>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </ng-template>\r\n    </p-tabPanel>\r\n</p-tabView>",
                styles: ["input[type=radio]{width:24px;height:24px;border-radius:12px;border:2px solid #1fbed6;background-color:#fff;-webkit-appearance:none;-moz-appearance:none}input[type=radio]:focus{outline:none}input[type=radio]:checked{background-color:#1fbed6}.ui-state-active~span:first-of-type,input[type=radio]:checked~span:first-of-type{color:#fff}label span:first-of-type{position:relative;left:-15px;color:#b9db00}label span{position:relative;top:1px}.ui-float-label>.ui-inputwrapper-filled~label,.ui-float-label>.ui-inputwrapper-focus~label,.ui-float-label>input.ui-state-filled~label,.ui-float-label>input:focus~label{top:-.75em;font-size:12px}"]
            },] }
];
StartTestComponent.ctorParameters = () => [
    { type: FormBuilder }
];
StartTestComponent.propDecorators = {
    testSheet: [{ type: Input, args: ['testSheet',] }],
    ansFilling: [{ type: Input, args: ['ansFilling',] }],
    timeUp: [{ type: Input, args: ['timeUp',] }],
    outputFunction: [{ type: Output, args: ['outputFunction',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhcnQtdGVzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9zdGFydC10ZXN0L3NyYy9saWIvc3RhcnQtdGVzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMvRSxPQUFPLEVBQUUsV0FBVyxFQUFhLE1BQU0sZ0JBQWdCLENBQUM7QUFReEQsTUFBTSxPQUFPLGtCQUFrQjtJQVk3QixZQUFvQixFQUFlO1FBQWYsT0FBRSxHQUFGLEVBQUUsQ0FBYTtRQVRkLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFFdkIsbUJBQWMsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUlqRixpQkFBWSxHQUFnQixFQUFFLENBQUM7SUFHUSxDQUFDO0lBRXhDLFFBQVE7UUFDTixJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUMzQixJQUFHLElBQUksRUFBQztnQkFDTixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7YUFDZDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxRQUFRLENBQUMsR0FBUSxFQUFFLE9BQVksRUFBRTtRQUMvQixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ3RCLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQztZQUNMLEdBQUcsRUFBRSxFQUFFO1lBQ1AsTUFBTSxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ2YsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO1NBQ2IsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNELFVBQVU7UUFDUixJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNqQixJ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eEIsVUFBVSxFQUFFLElBQUksQ0FBQyxRQUFRO3dCQUN6QixPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUs7cUJBQ3BCLENBQUMsQ0FBQztpQkFDSjtZQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsWUFBWSxHQUFHLFNBQVMsQ0FBQztRQUM5QixJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7UUFDeEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVELEtBQUs7UUFDSCxzRUFBc0U7UUFDdEUsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoRCxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDOUIsQ0FBQzs7O1lBaEdGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsWUFBWTtnQkFDdEIsdTdIQUEwQzs7YUFFM0M7OztZQVBRLFdBQVc7Ozt3QkFVakIsS0FBSyxTQUFDLFdBQVc7eUJBQ2pCLEtBQUssU0FBQyxZQUFZO3FCQUNsQixLQUFLLFNBQUMsUUFBUTs2QkFDZCxNQUFNLFNBQUMsZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc3RhcnQtdGVzdCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9zdGFydC10ZXN0LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vc3RhcnQtdGVzdC5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgU3RhcnRUZXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICBASW5wdXQoJ3Rlc3RTaGVldCcpIHRlc3RTaGVldDogYW55O1xuICBASW5wdXQoJ2Fuc0ZpbGxpbmcnKSBhbnNGaWxsaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgndGltZVVwJykgdGltZVVwOiBTdWJqZWN0PGJvb2xlYW4+O1xuICBAT3V0cHV0KCdvdXRwdXRGdW5jdGlvbicpIG91dHB1dEZ1bmN0aW9uOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBmaW5hbERhdGFMaXN0OiBhbnk7XG5cbiAgc2VjdGlvbnNGb3JtOiBGb3JtR3JvdXBbXSA9IFtdO1xuICBpbnB1dEZvcm06IEZvcm1Hcm91cDtcbiAgXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyKSB7IH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnRpbWVVcC5zdWJzY3JpYmUocmVzcCA9PntcbiAgICAgIGlmKHJlc3Ape1xuICAgICAgICB0aGlzLnN1Ym10KCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5jcmVhdGVUZXN0KCk7XG4gIH1cblxuICBpbml0Rm9ybShxaWQ6IGFueSwgY29kZTogYW55ID0gJycpe1xuICAgIHJldHVybiB0aGlzLmZiLmdyb3VwKHtcblx0XHRcdHE6IFtxaWRdLFxuICAgICAgYW5zOiBbXSxcbiAgICAgIHJldmlldzogW2ZhbHNlXSxcbiAgICAgIGNBbnM6IFtudWxsXVxuICAgIH0pO1xuICB9XG4gIGNyZWF0ZVRlc3QoKXtcbiAgICBsZXQgaSA9IDEsIGogPSAwO1xuICAgIGxldCBmb3Jtc0RhdGEgPSBbXTtcbiAgICB0aGlzLmZpbmFsRGF0YUxpc3QgPSBbXTsgXG4gICAgdGhpcy5pbnB1dEZvcm0gPSB0aGlzLmZiLmdyb3VwKHtcblx0XHRcdGlkOiBbdGhpcy50ZXN0U2hlZXQuaWRdLFxuICAgIH0pO1xuICAgIHRoaXMudGVzdFNoZWV0LnNlY3Rpb25zLmZvckVhY2goc2VjID0+IHtcbiAgICAgIGxldCBmaW5hbERhdGE6IGFueSA9IG5ldyBPYmplY3QoKTtcbiAgICAgIHRoaXMuZmluYWxEYXRhTGlzdC5wdXNoKGZpbmFsRGF0YSk7XG4gICAgICBmaW5hbERhdGEuc2VjID0gc2VjLnNlYztcbiAgICAgIGZpbmFsRGF0YS5mb3Jtc0RhdGEgPSBbXTtcbiAgICAgIHNlYy50eXBlcy5mb3JFYWNoKHR5cHMgPT4ge1xuICAgICAgICBsZXQgb3B0czogYW55ID0gW107XG4gICAgICAgIGxldCBzZWNUeXBlczogYW55ID0gbmV3IE9iamVjdCgpO1xuICAgICAgICBmaW5hbERhdGEuZm9ybXNEYXRhLnB1c2goc2VjVHlwZXMpO1xuICAgICAgICBzZWNUeXBlcy5mb3Jtc0RhdGEgPSBbXTtcbiAgICAgICAgaWYodHlwcy5xVHlwZS5jb2RlICE9IFwiSU5QVVRcIil7XG4gICAgICAgICAgaWYodHlwcy5vcHRUeXBlID09IFwibnVtYmVyXCIpe1xuICAgICAgICAgICAgZm9yKGxldCB0bXBfaSA9IDE7IHRtcF9pIDw9IHR5cHMub3B0Q291bnQ7IHRtcF9pKyspe1xuICAgICAgICAgICAgICBvcHRzLnB1c2godG1wX2kpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IobGV0IHRtcF9pID0gMTsgdG1wX2kgPD0gdHlwcy5vcHRDb3VudDsgdG1wX2krKyl7XG4gICAgICAgICAgICAgIG9wdHMucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKHRtcF9pKzY0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9wdHMgPSAnaW5wdXQnO1xuICAgICAgICB9XG4gICAgICAgIHNlY1R5cGVzLmluZm8gPSBgJHt0eXBzLnFUeXBlLm5hbWV9LmA7XG4gICAgICAgIGlmKCh0eXBzLnRvIC0gdHlwcy5mcm9tICsgMSkgIT0gdHlwcy5jb25zaWRlcil7XG4gICAgICAgICAgc2VjVHlwZXMuaW5mbyA9IGAke3NlY1R5cGVzLmluZm99IE9ubHkgZmlyc3QgJHt0eXBzLmNvbnNpZGVyfSBhbnN3ZXJzIHdpbGwgYmUgZXZhbHVhdGVkLmA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VjVHlwZXMuaW5mbyA9IGAke3NlY1R5cGVzLmluZm99IEFsbCBRdWVzdGlvbnMgQXJlIE1hbmRhdG9yeS5gO1xuICAgICAgICB9XG4gICAgICAgIGZvcihsZXQgdG1wX2kgPSB0eXBzLmZyb207IHRtcF9pIDw9IHR5cHMudG87IHRtcF9pKyspe1xuICAgICAgICAgIGxldCBmaWQ6IGFueSA9IHRoaXMuaW5pdEZvcm0oYCR7c2VjLnNlY0lkfS0ke2l9YCwgdHlwcy5xVHlwZS5jb2RlKTtcbiAgICAgICAgICBmb3Jtc0RhdGEucHVzaChmaWQpO1xuICAgICAgICAgIHNlY1R5cGVzLmZvcm1zRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICdpZCc6IGZpZCxcbiAgICAgICAgICAgICdxJzogaSsrLFxuICAgICAgICAgICAgJ29wdCc6IG9wdHMsXG4gICAgICAgICAgICAncVR5cGUnOiB0eXBzLnFUeXBlLmNvZGUsXG4gICAgICAgICAgICAnY3V0TWFya3MnOiB0eXBzLmN1dE1hcmtzLFxuICAgICAgICAgICAgJ21hcmtzJzogdHlwcy5tYXJrc1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICB0aGlzLnNlY3Rpb25zRm9ybSA9IGZvcm1zRGF0YTtcbiAgICB0aGlzLmlucHV0Rm9ybS5hZGRDb250cm9sKFwic2VjdGlvbnNcIiwgdGhpcy5mYi5hcnJheSh0aGlzLnNlY3Rpb25zRm9ybSkpO1xuICAgIGNvbnNvbGUubG9nKHRoaXMuZmluYWxEYXRhTGlzdCk7XG4gIH1cblxuICBzdWJtdCgpe1xuICAgIC8vbGV0IHQgPSBPYmplY3QuYXNzaWduKHt9LCAodGhpcy5mYi5hcnJheSh0aGlzLnNlY3Rpb25zRm9ybSkpLnZhbHVlKTtcbiAgICBsZXQgdCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW5wdXRGb3JtLnZhbHVlKTtcbiAgICBjb25zb2xlLmxvZyh0KTtcbiAgICB0aGlzLm91dHB1dEZ1bmN0aW9uLmVtaXQodCk7XG4gIH1cbn1cbiJdfQ==